<Window x:Class="MikroTikMonitor.LegacyMainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MikroTikMonitor"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
        xmlns:lvccore="clr-namespace:LiveChartsCore;assembly=LiveChartsCore"
        xmlns:converters="clr-namespace:MikroTikMonitor.ViewModels.Converters"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="MikroTik Monitor" 
        Height="800" 
        Width="1280"
        MinHeight="600" 
        MinWidth="800"
        WindowStartupLocation="CenterScreen"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        FontFamily="{materialDesign:MaterialDesignFont}"
        Icon="/Resources/Icons/app_icon.ico">
    
    <Window.Resources>
        <ResourceDictionary>
            <converters:CollectionToSeriesMultiConverter x:Key="CollectionToSeriesMultiConverter"/>
            <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
            <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
            <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
            <converters:StatusToColorConverter x:Key="StatusToColorConverter"/>
            <Style x:Key="SidebarButton" TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
                <Setter Property="Height" Value="48" />
                <Setter Property="Margin" Value="8,2" />
                <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBody}" />
                <Setter Property="FontWeight" Value="Medium" />
                <Setter Property="HorizontalContentAlignment" Value="Left" />
                <Setter Property="TextElement.FontSize" Value="14" />
                <Setter Property="Padding" Value="16,8" />
                <Setter Property="BorderThickness" Value="0" />
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource PrimaryHueLightBrush}" />
                        <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidForegroundBrush}" />
                    </Trigger>
                </Style.Triggers>
            </Style>
            
            <Style x:Key="SectionTitle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontWeight" Value="Medium" />
                <Setter Property="Margin" Value="0,16,0,8" />
                <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}" />
            </Style>
            
            <Style x:Key="InfoCard" TargetType="materialDesign:Card">
                <Setter Property="Margin" Value="8" />
                <Setter Property="Padding" Value="16" />
                <Setter Property="UniformCornerRadius" Value="8" />
                <Setter Property="Background" Value="{DynamicResource MaterialDesignCardBackground}" />
            </Style>
            
            <Style x:Key="DataGrid" TargetType="DataGrid" BasedOn="{StaticResource MaterialDesignDataGrid}">
                <Setter Property="AutoGenerateColumns" Value="False" />
                <Setter Property="CanUserAddRows" Value="False" />
                <Setter Property="CanUserDeleteRows" Value="False" />
                <Setter Property="IsReadOnly" Value="True" />
                <Setter Property="SelectionMode" Value="Single" />
                <Setter Property="SelectionUnit" Value="FullRow" />
                <Setter Property="HeadersVisibility" Value="Column" />
                <Setter Property="GridLinesVisibility" Value="None" />
                <Setter Property="BorderThickness" Value="0" />
                <Setter Property="Background" Value="Transparent" />
                <Setter Property="RowBackground" Value="Transparent" />
                <Setter Property="AlternatingRowBackground" Value="{DynamicResource MaterialDesignDivider}" />
            </Style>
        </ResourceDictionary>
    </Window.Resources>
    
    <materialDesign:DialogHost Identifier="MainDialogHost">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            
            <!-- App Bar -->
            <materialDesign:ColorZone Mode="PrimaryDark" Padding="16" materialDesign:ElevationAssist.Elevation="Dp4"
                                      Grid.Row="0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Orientation="Horizontal" Grid.Column="0">
                        <materialDesign:PackIcon Kind="Router" Width="32" Height="32" VerticalAlignment="Center" />
                        <TextBlock Text="MikroTik Monitor" VerticalAlignment="Center" Margin="16,0,0,0" 
                                   FontSize="22" FontWeight="Medium" />
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" Grid.Column="2" HorizontalAlignment="Right">
                        <Button Style="{StaticResource MaterialDesignFlatButton}" ToolTip="Refresh" Margin="4,0"
                                Command="{Binding RefreshCommand}">
                            <materialDesign:PackIcon Kind="Refresh" Width="24" Height="24" />
                        </Button>
                        <Button Style="{StaticResource MaterialDesignFlatButton}" ToolTip="Settings" Margin="4,0">
                            <materialDesign:PackIcon Kind="Settings" Width="24" Height="24" />
                        </Button>
                    </StackPanel>
                </Grid>
            </materialDesign:ColorZone>
            
            <!-- Main Content -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                
                <!-- Sidebar -->
                <materialDesign:Card Grid.Column="0" Margin="16" UniformCornerRadius="8"
                                     Background="{DynamicResource MaterialDesignCardBackground}"
                                     materialDesign:ElevationAssist.Elevation="Dp2">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        
                        <!-- Router Selector -->
                        <ComboBox Grid.Row="0" Margin="16,16,16,0" 
                                  ItemsSource="{Binding Routers}"
                                  SelectedItem="{Binding SelectedRouter}"
                                  DisplayMemberPath="Name"
                                  materialDesign:HintAssist.Hint="Select Router" />
                        
                        <!-- Navigation Menu -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,16,0,0">
                            <StackPanel>
                                <Button Style="{StaticResource SidebarButton}" Content="Dashboard">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="ViewDashboard" Width="24" Height="24" VerticalAlignment="Center" />
                                                <TextBlock Text="Dashboard" Margin="16,0,0,0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                
                                <Button Style="{StaticResource SidebarButton}" Content="Interfaces">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="NetworkOutline" Width="24" Height="24" VerticalAlignment="Center" />
                                                <TextBlock Text="Interfaces" Margin="16,0,0,0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                
                                <Button Style="{StaticResource SidebarButton}" Content="DHCP">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="IpNetwork" Width="24" Height="24" VerticalAlignment="Center" />
                                                <TextBlock Text="DHCP" Margin="16,0,0,0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                
                                <Button Style="{StaticResource SidebarButton}" Content="Traffic">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="ChartLineVariant" Width="24" Height="24" VerticalAlignment="Center" />
                                                <TextBlock Text="Traffic" Margin="16,0,0,0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                
                                <Button Style="{StaticResource SidebarButton}" Content="Firewall">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="ShieldOutline" Width="24" Height="24" VerticalAlignment="Center" />
                                                <TextBlock Text="Firewall" Margin="16,0,0,0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                
                                <Button Style="{StaticResource SidebarButton}" Content="QoS">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="SpeedHigh" Width="24" Height="24" VerticalAlignment="Center" />
                                                <TextBlock Text="QoS" Margin="16,0,0,0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                
                                <Button Style="{StaticResource SidebarButton}" Content="VPN">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="VpnOutline" Width="24" Height="24" VerticalAlignment="Center" />
                                                <TextBlock Text="VPN" Margin="16,0,0,0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                
                                <Button Style="{StaticResource SidebarButton}" Content="Logs">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="TextBoxMultipleOutline" Width="24" Height="24" VerticalAlignment="Center" />
                                                <TextBlock Text="Logs" Margin="16,0,0,0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                                
                                <Button Style="{StaticResource SidebarButton}" Content="Settings">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="CogOutline" Width="24" Height="24" VerticalAlignment="Center" />
                                                <TextBlock Text="Settings" Margin="16,0,0,0" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                            </StackPanel>
                        </ScrollViewer>
                        
                        <!-- Connection Controls -->
                        <StackPanel Grid.Row="2" Margin="16">
                            <Button Style="{StaticResource MaterialDesignRaisedButton}" 
                                    Command="{Binding ConnectCommand}" 
                                    Visibility="{Binding SelectedRouter.IsConnected, Converter={StaticResource InverseBooleanToVisibilityConverter}}"
                                    IsEnabled="{Binding IsConnecting, Converter={StaticResource InverseBooleanConverter}}"
                                    materialDesign:ButtonAssist.CornerRadius="4" 
                                    Height="36" 
                                    Margin="0,8,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Connection" Width="20" Height="20" VerticalAlignment="Center" />
                                    <TextBlock Text="Connect" Margin="8,0,0,0" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            
                            <Button Style="{StaticResource MaterialDesignRaisedButton}" 
                                    Command="{Binding DisconnectCommand}" 
                                    Visibility="{Binding SelectedRouter.IsConnected, Converter={StaticResource BooleanToVisibilityConverter}}"
                                    IsEnabled="{Binding IsConnecting, Converter={StaticResource InverseBooleanConverter}}"
                                    materialDesign:ButtonAssist.CornerRadius="4" 
                                    Height="36" 
                                    Margin="0,8,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="ConnectionOff" Width="20" Height="20" VerticalAlignment="Center" />
                                    <TextBlock Text="Disconnect" Margin="8,0,0,0" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                            
                            <Button Style="{StaticResource MaterialDesignRaisedSecondaryButton}" 
                                    Command="{Binding AddRouterCommand}" 
                                    materialDesign:ButtonAssist.CornerRadius="4" 
                                    Height="36" 
                                    Margin="0,8,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="RouterPlus" Width="20" Height="20" VerticalAlignment="Center" />
                                    <TextBlock Text="Add Router" Margin="8,0,0,0" VerticalAlignment="Center" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Grid>
                </materialDesign:Card>
                
                <!-- Main Content Area (Dashboard) -->
                <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto" Margin="0,16,16,16">
                    <StackPanel>
                        <!-- System Info Section -->
                        <TextBlock Text="System Information" Style="{StaticResource SectionTitle}" Margin="0,0,0,8" />
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            
                            <materialDesign:Card Grid.Column="0" Style="{StaticResource InfoCard}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Information" Width="24" Height="24" VerticalAlignment="Center" />
                                        <TextBlock Text="Device Info" Margin="8,0,0,0" VerticalAlignment="Center" FontWeight="Medium" />
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Margin="0,16,0,0">
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="100" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Model:" Opacity="0.6" />
                                            <TextBlock Grid.Column="1" Text="{Binding SelectedRouter.SystemInfo.Model}" />
                                        </Grid>
                                        
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="100" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="RouterOS:" Opacity="0.6" />
                                            <TextBlock Grid.Column="1" Text="{Binding SelectedRouter.SystemInfo.RouterOsVersion}" />
                                        </Grid>
                                        
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="100" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="CPU:" Opacity="0.6" />
                                            <TextBlock Grid.Column="1" Text="{Binding SelectedRouter.SystemInfo.CpuInfoFormatted}" />
                                        </Grid>
                                        
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="100" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="Uptime:" Opacity="0.6" />
                                            <TextBlock Grid.Column="1" Text="{Binding SelectedRouter.SystemInfo.UptimeFormatted}" />
                                        </Grid>
                                    </StackPanel>
                                </Grid>
                            </materialDesign:Card>
                            
                            <materialDesign:Card Grid.Column="1" Style="{StaticResource InfoCard}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Memory" Width="24" Height="24" VerticalAlignment="Center" />
                                        <TextBlock Text="Resource Usage" Margin="8,0,0,0" VerticalAlignment="Center" FontWeight="Medium" />
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Row="1" Margin="0,16,0,0">
                                        <TextBlock Text="CPU Usage" Margin="0,8,0,4" Opacity="0.6" />
                                        <ProgressBar Value="{Binding SelectedRouter.ResourceUsage.CpuUsage}" 
                                                     Maximum="100" 
                                                     Height="8" 
                                                     Foreground="{DynamicResource CpuChartBrush}" />
                                        <TextBlock Text="{Binding SelectedRouter.ResourceUsage.CpuUsage, StringFormat={}{0:0.0}%}" 
                                                   HorizontalAlignment="Right" 
                                                   Margin="0,4,0,8" />
                                        
                                        <TextBlock Text="Memory Usage" Margin="0,8,0,4" Opacity="0.6" />
                                        <ProgressBar Value="{Binding SelectedRouter.SystemInfo.MemoryUsagePercentage}" 
                                                     Maximum="100" 
                                                     Height="8" 
                                                     Foreground="{DynamicResource MemoryChartBrush}" />
                                        <TextBlock Text="{Binding SelectedRouter.SystemInfo.MemoryUsageFormatted}" 
                                                   HorizontalAlignment="Right" 
                                                   Margin="0,4,0,8" />
                                        
                                        <TextBlock Text="Disk Usage" Margin="0,8,0,4" Opacity="0.6" />
                                        <ProgressBar Value="{Binding SelectedRouter.SystemInfo.StorageUsagePercentage}" 
                                                     Maximum="100" 
                                                     Height="8" />
                                        <TextBlock Text="{Binding SelectedRouter.SystemInfo.StorageUsageFormatted}" 
                                                   HorizontalAlignment="Right" 
                                                   Margin="0,4,0,0" />
                                    </StackPanel>
                                </Grid>
                            </materialDesign:Card>
                            
                            <materialDesign:Card Grid.Column="2" Style="{StaticResource InfoCard}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="ChartLineVariant" Width="24" Height="24" VerticalAlignment="Center" />
                                        <TextBlock Text="CPU History" Margin="8,0,0,0" VerticalAlignment="Center" FontWeight="Medium" />
                                    </StackPanel>
                                    
                                    <lvc:CartesianChart Grid.Row="1" Margin="0,16,0,0" Height="150">
                                        <lvc:CartesianChart.Series>
                                            <MultiBinding Converter="{StaticResource CollectionToSeriesMultiConverter}">
                                                <Binding Path="ChartVM.CpuSeries"/>
                                            </MultiBinding>
                                        </lvc:CartesianChart.Series>
                                        <lvc:CartesianChart.XAxes>
                                            <Binding Path="ChartVM.TimeAxis"/>
                                        </lvc:CartesianChart.XAxes>
                                        <lvc:CartesianChart.YAxes>
                                            <Binding Path="ChartVM.PercentAxis"/>
                                        </lvc:CartesianChart.YAxes>
                                    </lvc:CartesianChart>
                                </Grid>
                            </materialDesign:Card>
                        </Grid>
                        
                        <!-- Interface Section -->
                        <TextBlock Text="Network Interfaces" Style="{StaticResource SectionTitle}" />
                        
                        <materialDesign:Card Style="{StaticResource InfoCard}">
                            <DataGrid ItemsSource="{Binding SelectedRouter.Interfaces}" 
                                      Style="{StaticResource DataGrid}"
                                      Height="250">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Name" Binding="{Binding Name}" />
                                    <DataGridTextColumn Header="Type" Binding="{Binding Type}" />
                                    <DataGridTextColumn Header="IP Address" Binding="{Binding IpAddress}" />
                                    <DataGridTextColumn Header="MAC Address" Binding="{Binding MacAddress}" />
                                    <DataGridTemplateColumn Header="Status">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" Margin="4,2">
                                                    <Ellipse Width="10" Height="10" Margin="0,0,8,0" VerticalAlignment="Center"
                                                             Fill="{Binding Status, Converter={StaticResource StatusToColorConverter}}" />
                                                    <TextBlock Text="{Binding Status}" VerticalAlignment="Center" />
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn Header="RX Rate" Binding="{Binding RxSpeedFormatted}" />
                                    <DataGridTextColumn Header="TX Rate" Binding="{Binding TxSpeedFormatted}" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>
                        
                        <!-- Traffic Charts -->
                        <TextBlock Text="Traffic Charts" Style="{StaticResource SectionTitle}" />
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            
                            <materialDesign:Card Grid.Column="0" Style="{StaticResource InfoCard}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Download" Width="24" Height="24" VerticalAlignment="Center" />
                                        <TextBlock Text="Rx Traffic" Margin="8,0,0,0" VerticalAlignment="Center" FontWeight="Medium" />
                                    </StackPanel>
                                    
                                    <lvc:CartesianChart Grid.Row="1" Margin="0,16,0,0" Height="200">
                                        <lvc:CartesianChart.Series>
                                            <MultiBinding Converter="{StaticResource CollectionToSeriesMultiConverter}">
                                                <Binding Path="ChartVM.RxSeries"/>
                                            </MultiBinding>
                                        </lvc:CartesianChart.Series>
                                        <lvc:CartesianChart.XAxes>
                                            <Binding Path="ChartVM.TimeAxis"/>
                                        </lvc:CartesianChart.XAxes>
                                        <lvc:CartesianChart.YAxes>
                                            <Binding Path="ChartVM.SpeedAxis"/>
                                        </lvc:CartesianChart.YAxes>
                                    </lvc:CartesianChart>
                                </Grid>
                            </materialDesign:Card>
                            
                            <materialDesign:Card Grid.Column="1" Style="{StaticResource InfoCard}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    
                                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Upload" Width="24" Height="24" VerticalAlignment="Center" />
                                        <TextBlock Text="Tx Traffic" Margin="8,0,0,0" VerticalAlignment="Center" FontWeight="Medium" />
                                    </StackPanel>
                                    
                                    <lvc:CartesianChart Grid.Row="1" Margin="0,16,0,0" Height="200">
                                        <lvc:CartesianChart.Series>
                                            <MultiBinding Converter="{StaticResource CollectionToSeriesMultiConverter}">
                                                <Binding Path="ChartVM.TxSeries"/>
                                            </MultiBinding>
                                        </lvc:CartesianChart.Series>
                                        <lvc:CartesianChart.XAxes>
                                            <Binding Path="ChartVM.TimeAxis"/>
                                        </lvc:CartesianChart.XAxes>
                                        <lvc:CartesianChart.YAxes>
                                            <Binding Path="ChartVM.SpeedAxis"/>
                                        </lvc:CartesianChart.YAxes>
                                    </lvc:CartesianChart>
                                </Grid>
                            </materialDesign:Card>
                        </Grid>
                        
                        <!-- DHCP Leases -->
                        <TextBlock Text="DHCP Leases" Style="{StaticResource SectionTitle}" />
                        
                        <materialDesign:Card Style="{StaticResource InfoCard}">
                            <DataGrid ItemsSource="{Binding SelectedRouter.DhcpLeases}" 
                                      Style="{StaticResource DataGrid}"
                                      Height="200">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Host Name" Binding="{Binding Hostname}" />
                                    <DataGridTextColumn Header="IP Address" Binding="{Binding Address}" />
                                    <DataGridTextColumn Header="MAC Address" Binding="{Binding MacAddress}" />
                                    <DataGridTemplateColumn Header="Status">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" Margin="4,2">
                                                    <Ellipse Width="10" Height="10" Margin="0,0,8,0" VerticalAlignment="Center"
                                                             Fill="{Binding Status, Converter={StaticResource StatusToColorConverter}}" />
                                                    <TextBlock Text="{Binding Status}" VerticalAlignment="Center" />
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridCheckBoxColumn Header="Dynamic" Binding="{Binding Dynamic}" />
                                    <DataGridTextColumn Header="Last Seen" Binding="{Binding LastSeen, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}" />
                                    <DataGridTextColumn Header="Expires In" Binding="{Binding TimeRemainingFormatted}" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>
                        
                        <!-- Log Entries -->
                        <TextBlock Text="Recent Logs" Style="{StaticResource SectionTitle}" />
                        
                        <materialDesign:Card Style="{StaticResource InfoCard}" Margin="8,8,8,16">
                            <DataGrid ItemsSource="{Binding SelectedRouter.LogEntries}" 
                                      Style="{StaticResource DataGrid}"
                                      Height="200">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Time" Binding="{Binding TimeFormatted}" />
                                    <DataGridTemplateColumn Header="Severity">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding SeverityText}" 
                                                           Foreground="{Binding Severity, Converter={StaticResource StatusToColorConverter}}" />
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn Header="Topics" Binding="{Binding Topics}" />
                                    <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="*" />
                                </DataGrid.Columns>
                            </DataGrid>
                        </materialDesign:Card>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
            
            <!-- Status Bar -->
            <Grid Grid.Row="2" Background="{DynamicResource MaterialDesignDivider}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" 
                           Text="{Binding StatusMessage}" 
                           Margin="16,8" 
                           VerticalAlignment="Center" />
                
                <TextBlock Grid.Column="1" 
                           Text="{Binding SelectedRouter.ResourceUsage.LastUpdated, StringFormat={}Last update: {0:HH:mm:ss}}" 
                           Margin="16,8" 
                           VerticalAlignment="Center" 
                           HorizontalAlignment="Right" />
            </Grid>
            
            <!-- Loading Overlay -->
            <Grid Grid.Row="0" Grid.RowSpan="3" 
                  Background="#88000000" 
                  Visibility="{Binding IsConnecting, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <ProgressBar IsIndeterminate="True" 
                                 Width="48" 
                                 Height="48" 
                                 Style="{StaticResource MaterialDesignCircularProgressBar}" />
                    <TextBlock Text="Connecting..." 
                               Margin="0,16,0,0" 
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Grid>
            
            <!-- No Router Selected Overlay -->
            <Grid Grid.Row="1" Grid.Column="1" 
                  Background="{DynamicResource MaterialDesignPaper}" 
                  Visibility="{Binding SelectedRouter, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Inverse}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <materialDesign:PackIcon Kind="RouterWireless" 
                                             Width="64" 
                                             Height="64" 
                                             HorizontalAlignment="Center" 
                                             Opacity="0.6" />
                    <TextBlock Text="No Router Selected" 
                               Margin="0,16,0,0" 
                               FontSize="18"
                               Opacity="0.6"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="Add a router to get started" 
                               Margin="0,8,0,0" 
                               Opacity="0.6"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Grid>
        </Grid>
    </materialDesign:DialogHost>
</Window>